# Telegram Integration –¥–ª—è DeepSeek Persona

## –û–±–∑–æ—Ä

–ú–æ–¥—É–ª—å `deepseek_persona` —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å Telegram –±–æ—Ç–æ–º. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º –ø–æ–ª—É—á–∞—Ç—å —Å–æ–≤–µ—Ç—ã –∫–æ—É—á–∞ –∏ —Å—Ç–∏–ª–∏–∑–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç—ã –ø—Ä—è–º–æ –≤ Telegram.

## –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### 1. `/coach <–≤–æ–ø—Ä–æ—Å>`

–ü–æ–ª—É—á–∏—Ç—å —Å–æ–≤–µ—Ç –∫–æ—É—á–∞ –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ñ–∏—Ä–º–µ–Ω–Ω–æ–≥–æ —Å—Ç–∏–ª—è –±—Ä–µ–Ω–¥–∞ "–ù–∞ –°—á–∞—Å—Ç—å–µ".

**–ü—Ä–∏–º–µ—Ä:**
```
/coach –ö–∞–∫ –æ—Ç–≤–µ—Ç–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—É –Ω–∞ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–µ –æ —Ü–µ–Ω–µ?
```

**–û—Ç–≤–µ—Ç:**
```
üéì –°–æ–≤–µ—Ç –∫–æ—É—á–∞:

–•–µ–π, –¥–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º—Å—è –≤–º–µ—Å—Ç–µ üòä –ü–µ—Ä–µ–≤–µ–¥–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä –∫ —Ü–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞...
```

### 2. `/stylize <—Ç–µ–∫—Å—Ç>`

–°—Ç–∏–ª–∏–∑–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –ø–æ–¥ —Ñ–∏—Ä–º–µ–Ω–Ω—ã–π —Å—Ç–∏–ª—å –±—Ä–µ–Ω–¥–∞ "–ù–∞ –°—á–∞—Å—Ç—å–µ".

**–ü—Ä–∏–º–µ—Ä:**
```
/stylize –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —è –º–æ–≥—É –≤–∞–º –ø–æ–º–æ—á—å
```

**–û—Ç–≤–µ—Ç:**
```
‚ú® –°—Ç–∏–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:

–•–µ–π, –¥–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º—Å—è –≤–º–µ—Å—Ç–µ üòä –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —è –º–æ–≥—É –≤–∞–º –ø–æ–º–æ—á—å
```

### 3. `/persona_info`

–ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–µ—Ä—Å–æ–Ω–µ –±—Ä–µ–Ω–¥–∞ –∏ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥–∞—Ö.

**–ü—Ä–∏–º–µ—Ä:**
```
/persona_info
```

**–û—Ç–≤–µ—Ç:**
```
üåü –ü–µ—Ä—Å–æ–Ω–∞ –±—Ä–µ–Ω–¥–∞ ¬´–ù–∞ –°—á–∞—Å—Ç—å–µ¬ª

üìã –ü—Ä–∞–≤–∏–ª–∞ –æ–±—â–µ–Ω–∏—è:
‚Ä¢ –ì–æ–≤–æ—Ä–∏—Ç—å –æ—Ç –¥—É—à–∏, –±–µ–∑ –æ—Ñ–∏—Ü–∏–æ–∑–∞
‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º—è–≥–∫–∏–µ —Ñ—Ä–∞–∑—ã...
‚Ä¢ ...

üí¨ –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
‚Ä¢ /coach <–≤–æ–ø—Ä–æ—Å> - –ø–æ–ª—É—á–∏—Ç—å —Å–æ–≤–µ—Ç –∫–æ—É—á–∞
‚Ä¢ /stylize <—Ç–µ–∫—Å—Ç> - —Å—Ç–∏–ª–∏–∑–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç
‚Ä¢ /persona_info - —ç—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ú–æ–¥—É–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—Ä–µ—Ö—É—Ä–æ–≤–Ω–µ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

1. **–í–µ—Ä—Å–∏–æ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏** (`v1/`, `_current/`)
   - –°–æ–¥–µ—Ä–∂–∞—Ç —Ñ—É–Ω–∫—Ü–∏—é `register_telegram(dp, registry)`
   - –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥

2. **–ú–æ–¥—É–ª—å –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è** (`__init__.py`)
   - –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `register_telegram` –¥–ª—è –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑—á–∏–∫–∞
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç fallback –º–µ–∂–¥—É –≤–µ—Ä—Å–∏—è–º–∏

3. **–ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑—á–∏–∫** (`telegram/autoload.py`)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –º–æ–¥—É–ª–∏ —Å `register_telegram`
   - –í—ã–∑—ã–≤–∞–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –±–æ—Ç–∞

### –§–∞–π–ª—ã

- `modules/deepseek_persona/__init__.py` - –≠–∫—Å–ø–æ—Ä—Ç –¥–ª—è –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑—á–∏–∫–∞
- `modules/deepseek_persona/v1/__init__.py` - Telegram handlers –¥–ª—è –≤–µ—Ä—Å–∏–∏ 1
- `modules/deepseek_persona/_current/__init__.py` - Telegram handlers –¥–ª—è —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏
- `modules/deepseek_persona/v1/service.py` - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (persona_chat, apply_persona)
- `modules/deepseek_persona/v1/data/persona.json` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω—ã

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- `aiogram>=2.25,<3.0` - Telegram bot framework
- `fastapi>=0.104.0` - Web framework (–¥–ª—è HTTP API)
- DeepSeek API –∫–ª—é—á –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `DEEPSEEK_API_KEY`

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

```bash
cd "–ë–æ—Ç/salesbot_final(–∫–æ–ø–∏—è)"

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
export TELEGRAM_TOKEN="–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞"
export DEEPSEEK_API_KEY="–≤–∞—à_–∫–ª—é—á_deepseek"

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
python telegram_bot.py
```

### –ò–ª–∏ —á–µ—Ä–µ–∑ simple_telegram_bot.py

```bash
python simple_telegram_bot.py
```

## Graceful Degradation

–ï—Å–ª–∏ DeepSeek API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:
- –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç fallback –æ—Ç–≤–µ—Ç—ã
- –ë–æ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –±–∞–∑–æ–≤–æ–π —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–µ–π
- –ù–µ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –≤ —á–∞—Ç

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –º–æ–¥—É–ª—è–º–∏

–ú–æ–¥—É–ª—å `deepseek_persona` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥—Ä—É–≥–∏–º–∏ –º–æ–¥—É–ª—è–º–∏:
- `trainer_dialog_engine` - –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞
- `voice_arena` - –¥–ª—è —Ñ–∏—Ä–º–µ–Ω–Ω–æ–≥–æ —Å—Ç–∏–ª—è –æ–±—â–µ–Ω–∏—è
- `master_path` - –¥–ª—è –∫–æ—É—á–∏–Ω–≥–æ–≤—ã—Ö —Å–æ–≤–µ—Ç–æ–≤

## –û—Ç–ª–∞–¥–∫–∞

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –º–æ–¥—É–ª—è:

```python
from telegram.autoload import autoload_telegram_handlers
from aiogram import Bot, Dispatcher
from api.core.registry import ModuleRegistry

bot = Bot(token="YOUR_TOKEN")
dp = Dispatcher(bot)
registry = ModuleRegistry()

# –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑—á–∏–∫ –≤—ã–≤–µ–¥–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ:
# "[tg_autoload] Registered telegram handlers for modules.deepseek_persona"
autoload_telegram_handlers(dp, registry, package_name="modules")
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–æ–ª—É—á–∏—Ç—å —Å–æ–≤–µ—Ç –ø–æ —Ä–∞–±–æ—Ç–µ —Å –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è–º–∏

```
–ú–µ–Ω–µ–¥–∂–µ—Ä: /coach –ö–ª–∏–µ–Ω—Ç –≥–æ–≤–æ—Ä–∏—Ç "—ç—Ç–æ –¥–æ—Ä–æ–≥–æ", –∫–∞–∫ –æ—Ç–≤–µ—Ç–∏—Ç—å?

–ë–æ—Ç: üéì –°–æ–≤–µ—Ç –∫–æ—É—á–∞:

–•–µ–π, –¥–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º—Å—è –≤–º–µ—Å—Ç–µ üòä –ù–µ —Å–ø–æ—Ä—å —Å —Ü–µ–Ω–æ–π –Ω–∞–ø—Ä—è–º—É—é. 
–ü–µ—Ä–µ–∫–ª—é—á–∏ —Ñ–æ–∫—É—Å –Ω–∞ —Ü–µ–Ω–Ω–æ—Å—Ç—å: "–ü–æ–Ω–∏–º–∞—é, —á—Ç–æ –≤–æ–ø—Ä–æ—Å –±—é–¥–∂–µ—Ç–∞ –≤–∞–∂–µ–Ω. 
–î–∞–≤–∞–π –ø–æ—Å–º–æ—Ç—Ä–∏–º, —á—Ç–æ –¥–ª—è –≤–∞—Å —Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ –≤ –ø–æ–¥–∞—Ä–∫–µ..."
```

### –°—Ç–∏–ª–∏–∑–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É

```
–ú–µ–Ω–µ–¥–∂–µ—Ä: /stylize –î–æ–±—Ä—ã–π –¥–µ–Ω—å, —Ö–æ—Ç–∏–º –∑–∞–∫–∞–∑–∞—Ç—å –ø–µ—Å–Ω—é

–ë–æ—Ç: ‚ú® –°—Ç–∏–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:

–•–µ–π, –¥–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º—Å—è –≤–º–µ—Å—Ç–µ üòä –î–æ–±—Ä—ã–π –¥–µ–Ω—å, —Ö–æ—Ç–∏–º –∑–∞–∫–∞–∑–∞—Ç—å –ø–µ—Å–Ω—é
```

## –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ

–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `register_telegram` –≤ `v1/__init__.py`:

```python
@dp.message_handler(commands=["–Ω–æ–≤–∞—è_–∫–æ–º–∞–Ω–¥–∞"])
async def _cmd_–Ω–æ–≤–∞—è_–∫–æ–º–∞–Ω–¥–∞(message: types.Message):
    """–û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã"""
    from .service import –Ω–æ–≤–∞—è_—Ñ—É–Ω–∫—Ü–∏—è
    
    text = message.get_args()
    result = –Ω–æ–≤–∞—è_—Ñ—É–Ω–∫—Ü–∏—è(text)
    await message.reply(f"–†–µ–∑—É–ª—å—Ç–∞—Ç: {result}")
```

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ª–∏ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ `requirements.txt`
2. –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. –°—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ñ–∞–π–ª `data/persona.json`
4. –î–æ—Å—Ç—É–ø–µ–Ω –ª–∏ DeepSeek API

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ
**–í–µ—Ä—Å–∏—è:** 1.0
**–î–∞—Ç–∞:** 2024-11-21
